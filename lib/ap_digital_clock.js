/**
 * Digital clock
 * @constructor ApDigitalLock
 */

"use strict";

const React = require('react'),
      types = React.PropTypes,
      ReactDOM = require('react-dom'),
      classnames = require('classnames'),
      ApClock = require('./ap_clock'),
      ApDigitalClockMainDisplay = require('./ap_digital_clock_main_display'),
      ApDigitalClockSubDisplay = require('./ap_digital_clock_sub_display'),
      moment = require('moment'),
      PureRenderMixin = require('react-addons-pure-render-mixin'),
      chopcal = require('chopcal'),
      numcal = require('numcal');

/** @lends ApDigitalLock */
let ApDigitalLock = React.createClass({
    displayName: 'ApDigitalLock',

    //--------------------
    // Specs
    //--------------------

    propTypes: {
        showSeconds: types.bool
    },

    mixins: [PureRenderMixin],

    statics: {
        padZero: function (value, len) {
            let result = String(value);
            while (result.length < len) {
                result = "0" + result;
            }
            return result;
        }
    },

    getInitialState: function () {
        return {
            hours: "00",
            minutes: "00",
            seconds: "00",
            size: 256,
            labelWidth: 256
        };
    },

    getDefaultProps: function () {
        return {
            showSeconds: true
        };
    },

    render: function () {
        let s = this,
            state = s.state,
            props = s.props;

        let size = state.size;

        let mainFontSize = parseInt(size * 0.2),
            subFontSize = mainFontSize / 4;

        let boardStyle = {
            width: `${ size }px`,
            height: `${ size }px`
        };

        return React.createElement(
            ApClock,
            { className: classnames("ap-digital-clock", props.className) },
            React.createElement(
                'div',
                { className: 'ap-digital-clock-board', style: boardStyle },
                React.createElement(
                    'div',
                    { className: 'ap-digital-clock-dummy-text',
                        style: { lineHeight: `${ size }px` }
                    },
                    'f'
                ),
                React.createElement(
                    'div',
                    { className: 'ap-digital-clock-board-inner' },
                    React.createElement(ApDigitalClockMainDisplay, { hours: state.hours,
                        minutes: state.minutes,
                        seconds: state.seconds,
                        fontSize: mainFontSize,
                        onSizeChange: s.onMainDisplaySizeChange
                    }),
                    React.createElement(ApDigitalClockSubDisplay, { day: state.day,
                        width: state.labelWidth,
                        fontSize: subFontSize
                    })
                )
            )
        );
    },

    //--------------------
    // Lifecycle
    //--------------------

    componentWillMount: function () {
        let s = this;
        s._looping = true;
    },

    componentDidMount: function () {
        let s = this,
            props = s.props;

        let padZero = ApDigitalLock.padZero;

        function _loop() {
            if (!s._looping) {
                return;
            }
            let now = new Date();

            s.setState({
                hours: padZero(now.getHours(), 2),
                minutes: padZero(now.getMinutes(), 2),
                seconds: padZero(now.getSeconds(), 2),
                day: moment(now).format('LL')
            });
            window.requestAnimationFrame(_loop);
        }

        window.addEventListener('resize', s.resizeClock);
        _loop();
        s.resizeClock();
    },

    componentWillUnmount: function () {
        let s = this;
        window.removeEventListener('resize', s.resizeClock);
        s._looping = false;
    },

    //------------------
    // Helper
    //------------------

    resizeClock: function () {
        let s = this,
            elm = ReactDOM.findDOMNode(s);
        let size = numcal.min(elm.offsetWidth, elm.offsetHeight);
        s.setState({
            size: size
        });
    },

    onMainDisplaySizeChange: function (sizes) {
        let s = this;
        s.setState({
            labelWidth: sizes.innerWidth
        });
    }

});

module.exports = ApDigitalLock;
//# sourceMappingURL=data:application/json;base64,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YUFDaEMsQ0FBQyxDQUFDO0FBQ0gsa0JBQU0sQ0FBQyxxQkFBcUIsQ0FBQyxLQUFLLENBQUMsQ0FBQztTQUN2Qzs7QUFFRCxjQUFNLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQyxXQUFXLENBQUMsQ0FBQztBQUNqRCxhQUFLLEVBQUUsQ0FBQztBQUNSLFNBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztLQUNuQjs7QUFFRCx3QkFBb0IsRUFBRSxZQUFZO0FBQzlCLFlBQUksQ0FBQyxHQUFHLElBQUksQ0FBQztBQUNiLGNBQU0sQ0FBQyxtQkFBbUIsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxDQUFDO0FBQ3BELFNBQUMsQ0FBQyxRQUFRLEdBQUcsS0FBSyxDQUFDO0tBQ3RCOzs7Ozs7QUFNRCxlQUFXLEVBQUUsWUFBWTtBQUNyQixZQUFJLENBQUMsR0FBRyxJQUFJO1lBQ1IsR0FBRyxHQUFHLFFBQVEsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDbEMsWUFBSSxJQUFJLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsV0FBVyxFQUFFLEdBQUcsQ0FBQyxZQUFZLENBQUMsQ0FBQztBQUN6RCxTQUFDLENBQUMsUUFBUSxDQUFDO0FBQ1AsZ0JBQUksRUFBRSxJQUFJO1NBQ2IsQ0FBQyxDQUFDO0tBQ047O0FBRUQsMkJBQXVCLEVBQUUsVUFBVSxLQUFLLEVBQUU7QUFDdEMsWUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDO0FBQ2IsU0FBQyxDQUFDLFFBQVEsQ0FBQztBQUNQLHNCQUFVLEVBQUUsS0FBSyxDQUFDLFVBQVU7U0FDL0IsQ0FBQyxDQUFDO0tBQ047O0NBRUosQ0FBQyxDQUFDOztBQUVILE1BQU0sQ0FBQyxPQUFPLEdBQUcsYUFBYSxDQUFDIiwiZmlsZSI6ImFwX2RpZ2l0YWxfY2xvY2suanMiLCJzb3VyY2VSb290IjoiL1VzZXJzL29rdW5pc2hpdGFrYS9wcm9qZWN0cy9hcGVtYW4tcmVhY3QtbGFiby9hcGVtYW4tcmVhY3QtY2xvY2svbGliL2pzeCIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogRGlnaXRhbCBjbG9ja1xuICogQGNvbnN0cnVjdG9yIEFwRGlnaXRhbExvY2tcbiAqL1xuXG5cInVzZSBzdHJpY3RcIjtcblxuY29uc3QgUmVhY3QgPSByZXF1aXJlKCdyZWFjdCcpLFxuICAgIHR5cGVzID0gUmVhY3QuUHJvcFR5cGVzLFxuICAgIFJlYWN0RE9NID0gcmVxdWlyZSgncmVhY3QtZG9tJyksXG4gICAgY2xhc3NuYW1lcyA9IHJlcXVpcmUoJ2NsYXNzbmFtZXMnKSxcbiAgICBBcENsb2NrID0gcmVxdWlyZSgnLi9hcF9jbG9jaycpLFxuICAgIEFwRGlnaXRhbENsb2NrTWFpbkRpc3BsYXkgPSByZXF1aXJlKCcuL2FwX2RpZ2l0YWxfY2xvY2tfbWFpbl9kaXNwbGF5JyksXG4gICAgQXBEaWdpdGFsQ2xvY2tTdWJEaXNwbGF5ID0gcmVxdWlyZSgnLi9hcF9kaWdpdGFsX2Nsb2NrX3N1Yl9kaXNwbGF5JyksXG4gICAgbW9tZW50ID0gcmVxdWlyZSgnbW9tZW50JyksXG4gICAgUHVyZVJlbmRlck1peGluID0gcmVxdWlyZSgncmVhY3QtYWRkb25zLXB1cmUtcmVuZGVyLW1peGluJyksXG4gICAgY2hvcGNhbCA9IHJlcXVpcmUoJ2Nob3BjYWwnKSxcbiAgICBudW1jYWwgPSByZXF1aXJlKCdudW1jYWwnKTtcblxuXG4vKiogQGxlbmRzIEFwRGlnaXRhbExvY2sgKi9cbmxldCBBcERpZ2l0YWxMb2NrID0gUmVhY3QuY3JlYXRlQ2xhc3Moe1xuXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vIFNwZWNzXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gICAgcHJvcFR5cGVzOiB7XG4gICAgICAgIHNob3dTZWNvbmRzOiB0eXBlcy5ib29sXG4gICAgfSxcblxuICAgIG1peGluczogW1xuICAgICAgICBQdXJlUmVuZGVyTWl4aW5cbiAgICBdLFxuXG4gICAgc3RhdGljczoge1xuICAgICAgICBwYWRaZXJvOiBmdW5jdGlvbiAodmFsdWUsIGxlbikge1xuICAgICAgICAgICAgbGV0IHJlc3VsdCA9IFN0cmluZyh2YWx1ZSk7XG4gICAgICAgICAgICB3aGlsZSAocmVzdWx0Lmxlbmd0aCA8IGxlbikge1xuICAgICAgICAgICAgICAgIHJlc3VsdCA9IFwiMFwiICsgcmVzdWx0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBnZXRJbml0aWFsU3RhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGhvdXJzOiBcIjAwXCIsXG4gICAgICAgICAgICBtaW51dGVzOiBcIjAwXCIsXG4gICAgICAgICAgICBzZWNvbmRzOiBcIjAwXCIsXG4gICAgICAgICAgICBzaXplOiAyNTYsXG4gICAgICAgICAgICBsYWJlbFdpZHRoOiAyNTZcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBnZXREZWZhdWx0UHJvcHM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHNob3dTZWNvbmRzOiB0cnVlXG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgcmVuZGVyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGxldCBzID0gdGhpcyxcbiAgICAgICAgICAgIHN0YXRlID0gcy5zdGF0ZSxcbiAgICAgICAgICAgIHByb3BzID0gcy5wcm9wcztcblxuICAgICAgICBsZXQgc2l6ZSA9IHN0YXRlLnNpemU7XG5cbiAgICAgICAgbGV0IG1haW5Gb250U2l6ZSA9IHBhcnNlSW50KHNpemUgKiAwLjIpLFxuICAgICAgICAgICAgc3ViRm9udFNpemUgPSBtYWluRm9udFNpemUgLyA0O1xuXG4gICAgICAgIGxldCBib2FyZFN0eWxlID0ge1xuICAgICAgICAgICAgd2lkdGg6IGAke3NpemV9cHhgLFxuICAgICAgICAgICAgaGVpZ2h0OiBgJHtzaXplfXB4YFxuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8QXBDbG9jayBjbGFzc05hbWU9e2NsYXNzbmFtZXMoXCJhcC1kaWdpdGFsLWNsb2NrXCIsIHByb3BzLmNsYXNzTmFtZSl9PlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiYXAtZGlnaXRhbC1jbG9jay1ib2FyZFwiIHN0eWxlPXtib2FyZFN0eWxlfT5cbiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJhcC1kaWdpdGFsLWNsb2NrLWR1bW15LXRleHRcIlxuICAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlPXt7bGluZUhlaWdodDpgJHtzaXplfXB4YH19XG4gICAgICAgICAgICAgICAgICAgID5mXG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImFwLWRpZ2l0YWwtY2xvY2stYm9hcmQtaW5uZXJcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxBcERpZ2l0YWxDbG9ja01haW5EaXNwbGF5IGhvdXJzPXtzdGF0ZS5ob3Vyc31cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pbnV0ZXM9e3N0YXRlLm1pbnV0ZXN9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWNvbmRzPXtzdGF0ZS5zZWNvbmRzfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9udFNpemU9e21haW5Gb250U2l6ZX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uU2l6ZUNoYW5nZT17cy5vbk1haW5EaXNwbGF5U2l6ZUNoYW5nZX1cbiAgICAgICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgICAgICAgICA8QXBEaWdpdGFsQ2xvY2tTdWJEaXNwbGF5IGRheT17c3RhdGUuZGF5fVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aD17c3RhdGUubGFiZWxXaWR0aH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9udFNpemU9e3N1YkZvbnRTaXplfVxuICAgICAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8L0FwQ2xvY2s+XG4gICAgICAgICk7XG4gICAgfSxcblxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBMaWZlY3ljbGVcbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgICBjb21wb25lbnRXaWxsTW91bnQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgbGV0IHMgPSB0aGlzO1xuICAgICAgICBzLl9sb29waW5nID0gdHJ1ZTtcbiAgICB9LFxuXG4gICAgY29tcG9uZW50RGlkTW91bnQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgbGV0IHMgPSB0aGlzLFxuICAgICAgICAgICAgcHJvcHMgPSBzLnByb3BzO1xuXG4gICAgICAgIGxldCBwYWRaZXJvID0gQXBEaWdpdGFsTG9jay5wYWRaZXJvO1xuXG4gICAgICAgIGZ1bmN0aW9uIF9sb29wKCkge1xuICAgICAgICAgICAgaWYgKCFzLl9sb29waW5nKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IG5vdyA9IG5ldyBEYXRlKCk7XG5cbiAgICAgICAgICAgIHMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgIGhvdXJzOiBwYWRaZXJvKG5vdy5nZXRIb3VycygpLCAyKSxcbiAgICAgICAgICAgICAgICBtaW51dGVzOiBwYWRaZXJvKG5vdy5nZXRNaW51dGVzKCksIDIpLFxuICAgICAgICAgICAgICAgIHNlY29uZHM6IHBhZFplcm8obm93LmdldFNlY29uZHMoKSwgMiksXG4gICAgICAgICAgICAgICAgZGF5OiBtb21lbnQobm93KS5mb3JtYXQoJ0xMJylcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShfbG9vcCk7XG4gICAgICAgIH1cblxuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgcy5yZXNpemVDbG9jayk7XG4gICAgICAgIF9sb29wKCk7XG4gICAgICAgIHMucmVzaXplQ2xvY2soKTtcbiAgICB9LFxuXG4gICAgY29tcG9uZW50V2lsbFVubW91bnQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgbGV0IHMgPSB0aGlzO1xuICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigncmVzaXplJywgcy5yZXNpemVDbG9jayk7XG4gICAgICAgIHMuX2xvb3BpbmcgPSBmYWxzZTtcbiAgICB9LFxuXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBIZWxwZXJcbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gICAgcmVzaXplQ2xvY2s6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgbGV0IHMgPSB0aGlzLFxuICAgICAgICAgICAgZWxtID0gUmVhY3RET00uZmluZERPTU5vZGUocyk7XG4gICAgICAgIGxldCBzaXplID0gbnVtY2FsLm1pbihlbG0ub2Zmc2V0V2lkdGgsIGVsbS5vZmZzZXRIZWlnaHQpO1xuICAgICAgICBzLnNldFN0YXRlKHtcbiAgICAgICAgICAgIHNpemU6IHNpemVcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIG9uTWFpbkRpc3BsYXlTaXplQ2hhbmdlOiBmdW5jdGlvbiAoc2l6ZXMpIHtcbiAgICAgICAgbGV0IHMgPSB0aGlzO1xuICAgICAgICBzLnNldFN0YXRlKHtcbiAgICAgICAgICAgIGxhYmVsV2lkdGg6IHNpemVzLmlubmVyV2lkdGhcbiAgICAgICAgfSk7XG4gICAgfVxuXG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSBBcERpZ2l0YWxMb2NrO1xuIl19